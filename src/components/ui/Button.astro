---
import ArrowDownRight from 'phosphor-astro/ArrowDownRight.astro';

interface Props {
  variant?: 'primary' | 'secondary';
  class?: string;
  href?: string;
  isFullWidth?: boolean;
  withArrow?: boolean;
  // New props for button functionality
  as?: 'a' | 'button';
  type?: 'button' | 'submit' | 'reset';
  disabled?: boolean;
}

const {
  variant,
  class: className,
  href,
  isFullWidth,
  withArrow,
  as = 'a',
  type = 'button',
  disabled = false,
} = Astro.props as Props;

// Determine element type: explicit 'as' prop, or 'button' if no href
const Element = as === 'button' || !href ? 'button' : 'a';
---

{
  Element === 'a' ? (
    <a
      href={href}
      class:list={[
        className,
        'button',
        'container',
        variant,
        isFullWidth && 'fullWidth',
      ]}
    >
      <slot />
      {withArrow && (
        <span class="arrow-wrapper">
          <ArrowDownRight class={'arrow'} height={'2.6rem'} width={'2.6rem'} />
          <ArrowDownRight
            class={'arrow arrow-clone'}
            height={'2.6rem'}
            width={'2.6rem'}
          />
        </span>
      )}
    </a>
  ) : (
    <button
      type={type}
      disabled={disabled}
      class:list={[
        className,
        'button',
        'container',
        variant,
        isFullWidth && 'fullWidth',
        disabled && 'disabled',
      ]}
    >
      <slot />
      {withArrow && (
        <span class="arrow-wrapper">
          <ArrowDownRight class={'arrow'} height={'2.6rem'} width={'2.6rem'} />
          <ArrowDownRight
            class={'arrow arrow-clone'}
            height={'2.6rem'}
            width={'2.6rem'}
          />
        </span>
      )}
    </button>
  )
}

<style>
  .container {
    cursor: pointer;

    display: flex;
    gap: var(--s-10);
    align-items: center;
    justify-content: center;

    width: fit-content;
    height: 4.4rem;
    padding: 0 var(--s-24);
    border: none;
    border-radius: var(--radius-max);

    font-family: Grotesk, sans-serif;
    font-size: 1.5rem;
    font-weight: 600;
    text-decoration: none;
    letter-spacing: 0.25px;
    white-space: nowrap;

    transition: background-color 0.2s ease-in-out;

    &.fullWidth {
      width: 100%;
    }

    &.disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
  }

  .primary {
    color: var(--black);
    background-color: var(--primary-500);

    &:hover:not(.disabled) {
      background-color: var(--primary-400);
    }
  }

  .secondary {
    color: var(--text);
    background-color: var(--black);
  }

  /* Arrow fly-through animation container */
  .arrow-wrapper {
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.6rem;
    height: 2.6rem;
  }

  .arrow {
    transform: rotate(-90deg);
    transition: transform 0.3s ease-in-out;
  }

  /* Clone arrow - positioned outside (bottom-left), ready to fly in */
  .arrow-clone {
    position: absolute;
    top: 0;
    left: 0;
    /* Starts at lower-left, ready to fly in to upper-right */
    transform: rotate(-90deg) translate(-100%, -100%);
  }

  /* On hover: original arrow flies out (up-right), clone flies in */
  .container:hover .arrow:not(.arrow-clone) {
    /* Flies out to upper-right (direction arrow points) */
    transform: rotate(-90deg) translate(100%, 100%);
  }

  .container:hover .arrow-clone {
    transform: rotate(-90deg) translate(0%, 0%);
  }
</style>
