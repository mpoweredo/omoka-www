---
// Footer Section - Bento Grid layout with 3 columns on desktop
// Desktop: 3-column grid (1.5fr, 1fr, 1.5fr) with brand, nav, and CTA
// Mobile/Tablet: Single column stacked layout
// Bottom: Giant full-width SVG logo as visual anchor

import Button from '~components/ui/Button.astro';
import Typography from '~components/ui/Typography.astro';
import Logo from '~assets/logo-omoka.svg';
import OmokaLineLogo from '~assets/shapes/omoka-line-logo.svg';
import ArrowUpRight from 'phosphor-astro/ArrowUpRight.astro';
import { SECTIONS } from '~consts/sections';
import { PAGES } from '~consts/pages';

// Navigation links configuration for the middle column
const navLinks = [
  { href: '/', label: 'HOME', isActive: false },
  { href: `#${SECTIONS.HOW_IT_WORKS}`, label: 'HOW IT WORKS', isActive: false },
  { href: `#${SECTIONS.PRICING}`, label: 'PRICING', isActive: false },
  { href: PAGES.BLOG, label: 'BLOG', isActive: false },
  { href: PAGES.REQUEST_ACCESS, label: 'ACCESS', isActive: true },
];
---

<script>
  const footer = document.querySelector('footer');
  const header = document.querySelector('header');

  if (footer && header) {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            header.classList.add('headerHidden');
          } else {
            header.classList.remove('headerHidden');
          }
        });
      },
      {
        root: null,
        threshold: 0.75,
      },
    );

    observer.observe(footer);
  }
</script>

<footer class="footer">
  <!-- Main 3-column grid container -->
  <div class="gridContainer">
    <!-- Left Column: Brand Block -->
    <div class="leftColumn">
      <div class="brandContent">
        <!-- Logo and brand name -->
        <a class="brandLogo" href="/">
          <Logo />
        </a>

        <!-- Description text -->
        <Typography tag="p" styling="bodyL" class="description">
          omoka is a visual AI agent that replaces manual testing. It
          understands your business logic and finds bugs on its own. Stop
          wasting hours on QA and let AI handle the reports so you can ship
          faster without the stress.
        </Typography>

        <!-- Request Access Button (secondary variant) -->
        <Button href="/request-access" variant="secondary" withArrow>
          Request Access
        </Button>
      </div>

      <!-- Legal links pinned to bottom -->
      <div class="legalLinks">
        <a href={PAGES.PRIVACY} class="legalLink">
          <Typography tag="span" styling="bodyS">PRIVACY POLICY</Typography>
        </a>
        <a href={PAGES.TOS} class="legalLink">
          <Typography tag="span" styling="bodyS">TERMS OF SERVICE</Typography>
        </a>
      </div>
    </div>

    <!-- Middle Column: Navigation Menu -->
    <nav class="middleColumn">
      {
        navLinks.map((link) => (
          <a
            href={link.href}
            class:list={['navLink', { active: link.isActive }]}
          >
            <Typography tag="span" styling="headingXs">
              {link.label}
            </Typography>
            <ArrowUpRight class="navIcon" width="2.4rem" height="2.4rem" />
          </a>
        ))
      }
    </nav>

    <!-- Right Column: CTA Block -->
    <div class="rightColumn">
      <div class="ctaContent">
        <!-- CTA Heading -->
        <Typography tag="h3" styling="headingM" class="ctaHeading">
          Ready to change how you handle QA?
        </Typography>

        <!-- CTA Subtext -->
        <Typography tag="p" styling="paragraphM" class="ctaText">
          Join the waitlist for priority access to omoka. Secure an early
          adopter discount and get a free AI bug audit of your app before we
          launch in Q1 2026.
        </Typography>
      </div>

      <!-- Copyright pinned to bottom -->
      <div class="copyright">
        <Typography tag="span" styling="bodyS">
          Â© 2025 omoka All rights reserved.
        </Typography>
      </div>
    </div>
  </div>

  <!-- Giant Logo Section - Full width visual anchor -->
  <div class="giantLogoSection">
    <OmokaLineLogo class="giantLogo" />
  </div>
</footer>

<style lang="scss">
  @use '~styles/mixins/media' as *;

  .footer {
    // Break out of the parent container constraint
    position: relative;
    right: 50%;
    left: 50%;

    display: flex;
    flex-direction: column;

    // Full viewport width using transform to avoid scrollbar issues
    width: 100vw;
    max-width: 100vw;
    min-height: 101vh;
    margin-right: -50vw;

    // Center the element after shifting
    margin-left: -50vw;

    // Account for fixed header height
    border-top: 1px solid var(--black);

    // Force all text to be black
    color: var(--black);

    background-color: var(--primary-500);
  }

  // Main 3-column grid container
  .gridContainer {
    display: grid;
    grid-template-columns: 1fr;
    flex: 1;

    border-top: 1px solid var(--black);
    border-left: 1px solid var(--black);

    // Desktop: 3-column layout (1.5fr, 1fr, 1.5fr)
    @include media-min('lg') {
      grid-template-columns: 1.5fr 1fr 1.5fr;
    }
  }

  // ==========================================
  // Left Column - Brand Block
  // ==========================================
  .leftColumn {
    display: flex;
    flex-direction: column;
    gap: var(--s-32);
    justify-content: space-between;

    padding: var(--s-32);
    border-right: 1px solid var(--black);
    border-bottom: 1px solid var(--black);

    // Force text color inheritance
    color: var(--black);

    @include media-min('lg') {
      padding: var(--s-40);
      border-bottom: none;
    }
  }

  .brandContent {
    display: flex;
    flex-direction: column;

    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(p) {
      max-width: 32rem;
      margin-top: var(--s-24);
      margin-bottom: var(--s-40);
    }
  }

  .brandLogo {
    display: flex;
    align-items: center;

    width: fit-content;

    color: var(--black);
    text-decoration: none;

    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(svg) {
      width: auto;
      height: 2.8rem;

      /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
      :global(path) {
        fill: var(--black);
      }
    }
  }

  .legalLinks {
    display: flex;
    flex-wrap: wrap;
    gap: var(--s-24);
  }

  .legalLink {
    text-decoration: none;
    text-transform: uppercase;

    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(span) {
      color: var(--black);
    }

    &:hover {
      text-decoration: underline;
    }
  }

  // ==========================================
  // Middle Column - Navigation Menu
  // ==========================================
  .middleColumn {
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--black);
    border-bottom: 1px solid var(--black);

    @include media-min('lg') {
      border-bottom: none;
    }
  }

  .navLink {
    display: flex;
    flex: 1;
    align-items: center;
    justify-content: space-between;

    padding: var(--s-20) var(--s-24);
    border-top: 1px solid var(--black);

    text-decoration: none;

    transition:
      background-color 0.2s ease,
      color 0.2s ease;

    // Remove top border from first link to avoid double border with previous section
    &:first-child {
      border-top: none;
    }

    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(span) {
      color: var(--black);
    }

    .navIcon {
      flex-shrink: 0;
      color: var(--black);
    }

    &:hover {
      background-color: rgb(0 0 0 / 10%);
    }

    // Active state - solid black background with white text
    &.active {
      background-color: var(--black);

      /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
      :global(span) {
        color: var(--white);
      }

      .navIcon {
        color: var(--white);
      }

      &:hover {
        background-color: var(--gray-900);
      }
    }
  }

  // ==========================================
  // Right Column - CTA Block
  // ==========================================
  .rightColumn {
    display: flex;
    flex-direction: column;
    gap: var(--s-32);
    justify-content: space-between;

    padding: var(--s-32);
    border-right: 1px solid var(--black);
    border-bottom: 1px solid var(--black);

    // Force text color inheritance
    color: var(--black);

    @include media-min('lg') {
      padding: var(--s-40);
      border-bottom: none;
    }
  }

  .ctaContent {
    display: flex;
    flex-direction: column;
    gap: var(--s-24);
  }

  .ctaHeading {
    letter-spacing: -0.02em;

    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(h3) {
      color: var(--black);
    }
  }

  .ctaText {
    max-width: 32rem;

    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(p) {
      color: var(--black);
    }
  }

  .copyright {
    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(span) {
      color: var(--black);
    }
  }

  // ==========================================
  // Giant Logo Section - Full width anchor
  // ==========================================
  .giantLogoSection {
    display: flex;
    flex: 1;
    align-items: end;

    width: 100%;
    padding: var(--s-40) var(--s-16);

    // Only right and left borders - top border comes from rightColumn's bottom on mobile
    // and from grid container structure on desktop
    border-right: 1px solid var(--black);
    border-left: 1px solid var(--black);

    @include media-min('lg') {
      padding: var(--s-64) var(--s-40);

      // Add top border only on desktop (grid columns don't have bottom borders)
      border-top: 1px solid var(--black);
    }
  }

  .giantLogo {
    width: 100%;
    height: auto;

    /* stylelint-disable-next-line selector-pseudo-class-no-unknown */
    :global(svg) {
      width: 100%;
      height: auto;
    }
  }
</style>
