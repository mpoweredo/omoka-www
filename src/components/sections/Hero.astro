---
import Button from '~components/ui/Button.astro';
import Typography from '~components/ui/Typography.astro';
import LinesHeroShapes from '~assets/shapes/lines-hero.svg';
import HeroImage from '~assets/hero-image.svg';
import { Image } from 'astro:assets';

interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props as Props;
---

<section>
  <div class="hero">
    <div class="leftSide">
      <div class="texts">
        <Typography tag="h1" align="left">
          <Fragment
            set:html={title
              .split('\n')
              .map((line) => `<span class="line">${line}</span>`)}
          />
        </Typography>
        <div class="description">
          <Typography color="gray500" tag="p" styling="paragraphL" align="left">
            <Fragment set:html={description.replace(/\n/g, '<br />')} />
          </Typography>
        </div>
      </div>

      <Button href="/request-access" variant="primary" withArrow>
        Request Access
      </Button>
    </div>

    <div class="rightSide">
      <div class="linesReveal" data-hero-lines>
        <div class="linesContainer">
          <LinesHeroShapes style="height: 100%;" />
        </div>
      </div>
    </div>
  </div>

  <div class="heroImage">
    <!-- <Image src={HeroImage} alt="Hero Image" /> -->
  </div>
</section>

<script>
  import gsap from 'gsap';

  // Reveal animation with soft edge (animate mask position)
  const linesReveal = document.querySelector('[data-hero-lines]');

  if (linesReveal) {
    gsap.fromTo(
      linesReveal,
      {
        // Start: mask positioned far right (content hidden)
        maskPosition: '-220% 0',
      },
      {
        // End: mask covers content (fully visible)
        maskPosition: '50% 0',
        duration: 7,
        ease: 'back',
      },
    );
  }
</script>

<style lang="scss">
  @use '~styles/mixins/section' as *;
  @use '~styles/mixins/media' as *;

  .hero {
    @include section-borders;

    overflow: hidden;
    display: flex;
    justify-content: space-between;

    width: 100%;
    padding-right: var(--s-24);
    padding-left: var(--s-24);

    @include media-min('md') {
      padding-right: 0;
      padding-left: var(--s-46);
    }
  }

  .leftSide {
    display: flex;
    flex-direction: column;
    gap: var(--s-40);

    width: 100%;
    padding-top: calc(var(--header-height) + 160px);
    padding-bottom: 160px;

    @include media-min('sm') {
      padding-top: calc(var(--header-height) + 220px);
      padding-bottom: 220px;
    }
  }

  .rightSide {
    position: relative;

    display: flex;
    display: none;
    align-items: center;
    justify-content: end;

    width: 100%;

    @include media-min('sm') {
      display: flex;
    }
  }

  .texts {
    display: flex;
    flex-direction: column;
    gap: var(--s-20);

    width: 100%;
    height: fit-content;

    :global(h1) {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    :global(.line) {
      display: flex;
      flex-direction: column;
      width: fit-content;

      @include media-min('sm') {
        white-space: nowrap;
      }
    }
  }

  /* Wrapper for reveal animation with soft edge */
  .linesReveal {
    position: relative;

    display: flex;
    align-items: center;
    justify-content: end;

    width: 100%;
    height: 100%;

    /* Gradient mask for soft-edge reveal animation */

    /* Gradient goes to left = soft edge is on the left side */

    /* Black = visible, transparent = hidden */
    mask-image: linear-gradient(to left, black 0%, black 60%, transparent 100%);

    /* Initial state: hidden (GSAP animates mask-position) */
    mask-position: -150% 100%;
    mask-repeat: no-repeat;
    mask-size: 150% 100%;
  }

  /* Container for lines with ellipse mask applied */
  .linesContainer {
    position: relative;
    transform: translateY(30px);

    display: flex;
    align-items: flex-end;
    justify-content: flex-end;

    width: 100%;
    height: 100%;

    /* SVG mask with blur filter for smooth Figma-like edges */
    mask-image: url('/src/assets/shapes/ellipse-blur-mask.svg');
    mask-position: -100px 75px;
    mask-repeat: no-repeat;
    mask-size: 130% 85%;
  }

  .heroImage {
    display: none;
    width: 100%;
    max-width: 100%;
    object-fit: contain;

    & > img {
      display: block;

      width: 100%;
      height: 100%;
      border: 1px solid var(--gray-800);
      border-top: none;

      object-fit: contain;
    }

    @include media-min('sm') {
      display: block;
    }
  }
</style>
