---
import MainLayout from '~layouts/MainLayout.astro';
import { getCollection } from 'astro:content';
import Typography from '~components/ui/Typography.astro';
import { PAGES } from '~consts/pages';

// Pre-render at build time (static)
export const prerender = true;

// Get all glossary terms and sort alphabetically
const allTerms = await getCollection('glossary');
const sortedTerms = allTerms.sort((a, b) => {
  // First sort by letter
  if (a.data.letter < b.data.letter) return -1;
  if (a.data.letter > b.data.letter) return 1;
  // Then sort by term name within same letter
  return a.data.term.localeCompare(b.data.term);
});

// Group terms by letter
const termsByLetter = sortedTerms.reduce(
  (acc, term) => {
    const letter = term.data.letter.toUpperCase();
    if (!acc[letter]) {
      acc[letter] = [];
    }
    acc[letter].push(term);
    return acc;
  },
  {} as Record<string, typeof allTerms>,
);

// Get all unique letters that have terms
const letters = Object.keys(termsByLetter).sort();
---

<MainLayout
  title="devtimate | Software estimation glossary"
  description="Explore clear definitions of software project estimation terms, pricing models, and delivery concepts. Learn how agencies estimate projects, manage scope, and communicate with clients effectively."
>
  <section>
    <header>
      <Typography tag="h1" styling="headingL">
        Software estimation <span class="highlightText">glossary</span>
      </Typography>
      <Typography tag="p" styling="paragraphL">
        Your complete reference for software estimation and pricing terms.
        Understand how agencies plan, estimate,<br /> and deliver projects with accuracy
        and transparency.
      </Typography>
    </header>

    <div class="termsContainer">
      {
        letters.map((letter) => (
          <div>
            <Typography tag="p" styling="headingM">
              {letter}
            </Typography>

            <div class="termsList">
              {termsByLetter[letter].map((term) => (
                <Typography tag="p" styling="bodyL">
                  <a href={`${PAGES.GLOSSARY}/${term.slug}`}>
                    {term.data.term}
                  </a>
                </Typography>
              ))}
            </div>
          </div>
        ))
      }
    </div>
  </section>
</MainLayout>

<style lang="scss">
  @use '~styles/mixins/media' as *;

  section {
    margin-top: 100px;
    padding: 3rem 1rem;

    a {
      color: var(--text);
    }
  }

  header {
    display: flex;
    flex-direction: column;
    gap: var(--s-16);
    margin-bottom: var(--s-56);
  }

  .highlightText {
    position: relative;
    z-index: 1;
    background-color: var(--primary-lightest-doodle);
  }

  .termsContainer {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--s-12);

    @include media-min('md') {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--s-24);
    }
  }

  .termsList {
    display: flex;
    flex-direction: column;
    grid-template-columns: repeat(1, 1fr);
    margin-top: var(--s-16);
    gap: var(--s-8);

    @include media-min('sm') {
      grid-template-columns: repeat(2, 1fr);
    }

    @include media-min('md') {
      grid-template-columns: repeat(3, 1fr);
    }

    article {
      a {
        display: block;
        padding: var(--s-8) 0;

        &:hover {
          color: var(--gray-1200);
        }
      }
    }
  }
</style>
